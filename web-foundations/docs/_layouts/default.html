<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'es' }}" id="html-root">
	<head>
		<script>
			// Apply theme immediately to prevent flash - must be first script
			(function () {
				try {
					const theme = localStorage.getItem('theme') || 'light';
					if (theme === 'dark') {
						document.documentElement.classList.add('dark');
					}
				} catch (e) {
					// localStorage might not be available
				}
			})();
		</script>
		{% include head.html %}
	</head>
	<body
		class="bg-white dark:bg-neutral-950 text-slate-900 dark:text-neutral-100 antialiased transition-colors duration-200">
		<a href="#main" class="skip-link">
			{% if page.lang == 'es' or page.lang == 'es' %}Saltar al contenido{% else %}Skip to main content{% endif %}
		</a>
		{% include header.html %}
		<main id="main" class="min-h-screen prose-slate dark:prose-invert w-full max-w-none">
			{{ content }}
		</main>
		{% include footer.html %}
		<script>
			// Theme toggle functionality - ensure it runs after DOM is ready
			(function () {
				function initThemeToggle() {
					const themeToggle = document.getElementById('theme-toggle');
					const htmlRoot = document.documentElement;

					if (themeToggle) {
						themeToggle.addEventListener('click', function (e) {
							e.preventDefault();
							const isDark = htmlRoot.classList.toggle('dark');
							try {
								localStorage.setItem('theme', isDark ? 'dark' : 'light');
							} catch (e) {
								console.warn('Could not save theme preference:', e);
							}
						});
					}
				}

				// Run immediately if DOM is ready, otherwise wait
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initThemeToggle);
				} else {
					initThemeToggle();
				}
			})();
		</script>
	</body>
</html>
